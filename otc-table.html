<!DOCTYPE html>
<html>
<head>
    <title>Live OTC Stocks Table</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .otc-table { width: 100%; border-collapse: collapse; }
        .otc-table th, .otc-table td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        .otc-table th { background-color: #f2f2f2; position: sticky; top: 0; }
        .positive { color: green; }
        .negative { color: red; }
        .refresh-info { margin-top: 10px; font-size: 0.9em; color: #666; }
    </style>
</head>
<body>
    <h2>Top OTC Stocks - Live Prices</h2>
    <table class="otc-table">
        <thead>
            <tr>
                <th>Ticker</th>
                <th>Company</th>
                <th>Price</th>
                <th>Change</th>
                <th>% Change</th>
                <th>Volume</th>
            </tr>
        </thead>
        <tbody id="otc-data">
            <!-- Data will be inserted here by JavaScript -->
            <tr><td colspan="6">Loading data...</td></tr>
        </tbody>
    </table>
    <div class="refresh-info">Last updated: <span id="last-updated">Never</span> • Next update in <span id="countdown">15:00</span></div>

    <script>
        // Top OTC stocks to monitor (update this list as needed)
        const OTC_STOCKS = [
            { symbol: "TCEHY", name: "Tencent Holdings" },
            { symbol: "PDRDF", name: "Philip Morris International" },
            { symbol: "SFTBY", name: "SoftBank Group" },
            { symbol: "NSRGY", name: "Nestlé SA" },
            { symbol: "BOMN", name: "Boston Omaha" },
            { symbol: "CURVF", name: "Curative Biotech" },
            { symbol: "RWBYF", name: "Red White & Bloom" }
        ];

        // Free API endpoints (rotate to avoid rate limits)
        const API_SOURCES = [
            // TwelveData (free tier)
            symbol => `https://api.twelvedata.com/quote?symbol=${symbol}&apikey=demo&source=docs`,
            // Alpha Vantage (free tier)
            symbol => `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=demo`
        ];

        let currentApiIndex = 0;
        let updateInterval = 15 * 60 * 1000; // 15 minutes in milliseconds

        async function fetchStockData(symbol) {
            try {
                const apiUrl = API_SOURCES[currentApiIndex](symbol);
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                // Parse data based on API response format
                if (apiUrl.includes('twelvedata')) {
                    return {
                        price: parseFloat(data.close),
                        change: parseFloat(data.change),
                        changePercent: parseFloat(data.percent_change),
                        volume: parseInt(data.volume)
                    };
                } else { // Alpha Vantage format
                    const quote = data["Global Quote"];
                    return {
                        price: parseFloat(quote["05. price"]),
                        change: parseFloat(quote["09. change"]),
                        changePercent: parseFloat(quote["10. change percent"].replace('%', '')),
                        volume: parseInt(quote["06. volume"])
                    };
                }
            } catch (error) {
                console.error(`Error fetching ${symbol}:`, error);
                return null;
            }
        }

        async function updateAllStocks() {
            const tbody = document.getElementById('otc-data');
            tbody.innerHTML = '';
            
            for (const stock of OTC_STOCKS) {
                const data = await fetchStockData(stock.symbol);
                const row = document.createElement('tr');
                
                if (data) {
                    const changeClass = data.change >= 0 ? 'positive' : 'negative';
                    const changeSign = data.change >= 0 ? '+' : '';
                    
                    row.innerHTML = `
                        <td>${stock.symbol}</td>
                        <td>${stock.name}</td>
                        <td>$${data.price.toFixed(2)}</td>
                        <td class="${changeClass}">${changeSign}${data.change.toFixed(2)}</td>
                        <td class="${changeClass}">${changeSign}${data.changePercent.toFixed(2)}%</td>
                        <td>${data.volume.toLocaleString()}</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td>${stock.symbol}</td>
                        <td>${stock.name}</td>
                        <td colspan="4">Data unavailable</td>
                    `;
                }
                
                tbody.appendChild(row);
            }
            
            // Update timestamp and schedule next update
            const now = new Date();
            document.getElementById('last-updated').textContent = now.toLocaleTimeString();
            startCountdown();
        }

        function startCountdown() {
            let secondsLeft = updateInterval / 1000;
            const countdownElement = document.getElementById('countdown');
            
            const countdown = setInterval(() => {
                secondsLeft--;
                const minutes = Math.floor(secondsLeft / 60);
                const seconds = secondsLeft % 60;
                countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (secondsLeft <= 0) {
                    clearInterval(countdown);
                    updateAllStocks();
                }
            }, 1000);
        }

        // Rotate API source with each update
        function rotateApiSource() {
            currentApiIndex = (currentApiIndex + 1) % API_SOURCES.length;
        }

        // Initial load
        updateAllStocks();
        setInterval(rotateApiSource, updateInterval);
    </script>
</body>
</html>
